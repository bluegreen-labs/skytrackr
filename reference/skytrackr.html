<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sky (illuminance) location estimation routine — skytrackr • skytrackr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- ropensci --><link href="../bglabs.css" rel="stylesheet"><meta property="og:title" content="Sky (illuminance) location estimation routine — skytrackr"><meta property="og:description" content="Skytrack compares geolocator based light measurements in lux with
those modelled by the sky illuminance model of Janiczek and DeYoung (1987)."><meta name="twitter:card" content="summary"><!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo_text_small.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="external-link hidden-md hidden-lg" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="navbar-brand" href="../index.html">
           <i>skytrackr <small>v1.1</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/skytrackr_optimization.html">Optimization tips</a>
    </li>
    <li>
      <a href="../articles/skytrackr_parallel_processing.html">Parallel processing</a>
    </li>
    <li>
      <a href="../articles/skytrackr_vignette.html">The skytrackr R package</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/bluegreen-labs/skytrackr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sky (illuminance) location estimation routine</h1>
    <small class="dont-index">Source: <a href="https://github.com/bluegreen-labs/skytrackr/blob/main/R/skytrackr.R" class="external-link"><code>R/skytrackr.R</code></a></small>
    <div class="hidden name"><code>skytrackr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Skytrack compares geolocator based light measurements in lux with
those modelled by the sky illuminance model of Janiczek and DeYoung (1987).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">skytrackr</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">start_location</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>  range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">148</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-05</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sampler <span class="op">=</span> <span class="st">"DEzs"</span>, settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>burnin <span class="op">=</span> <span class="fl">1000</span>, iterations <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>    message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">mask</span>,</span>
<span>  <span class="va">step_selection</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  clip <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A skytrackr data frame.</p></dd>


<dt id="arg-start-location">start_location<a class="anchor" aria-label="anchor" href="#arg-start-location"></a></dt>
<dd><p>A start location of logging as a vector of
latitude and longitude</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p>Tolerance distance on the search window for optimization,
given in km (left/right, top/bottom). Sets a hard limit on the search window
regardless of the step selection function used.</p></dd>


<dt id="arg-range">range<a class="anchor" aria-label="anchor" href="#arg-range"></a></dt>
<dd><p>Range of values to consider during processing, should be
provided in lux c(min, max) or the equivalent if non-calibrated.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>Scale / sky condition factor, by default covering the
skylight() range of 1-10 (from clear sky to extensive cloud coverage)
but can be extended for more flexibility to account for coverage by plumage,
note that in case of non-physical accurate lux measurements values can have
a range starting at 0.0001 (a multiplier instead of a divider). Values need
to be provided on a log scale (default = log(c(0.00001, 50)))</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Control settings for the Bayesian optimization, generally
should not be altered (defaults to a Monte Carlo method). For detailed
information I refer to the BayesianTools package documentation.</p></dd>


<dt id="arg-window-size">window_size<a class="anchor" aria-label="anchor" href="#arg-window-size"></a></dt>
<dd><p>use a moving window across x days during data processing,
this effectively smooths responses (default = 1, day-by-day processing)</p></dd>


<dt id="arg-mask">mask<a class="anchor" aria-label="anchor" href="#arg-mask"></a></dt>
<dd><p>Mask to constrain positions to land</p></dd>


<dt id="arg-step-selection">step_selection<a class="anchor" aria-label="anchor" href="#arg-step-selection"></a></dt>
<dd><p>A step selection function on the distance of a proposed
move, step selection is specified on distance (in km) basis.</p></dd>


<dt id="arg-smooth">smooth<a class="anchor" aria-label="anchor" href="#arg-smooth"></a></dt>
<dd><p>smooth the data before processing (default = TRUE)</p></dd>


<dt id="arg-clip">clip<a class="anchor" aria-label="anchor" href="#arg-clip"></a></dt>
<dd><p>value over which lux values are clipped, to be set to the
saturation value of your system when using the full diurnal profile (not only
twilight) (default = NULL)</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Plot a map during location estimation (updated every seven days)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Give feedback including a progress bar (TRUE or FALSE,
default = TRUE)</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>debugging info and plots</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data frame with location estimate, their uncertainties, and
 ancillary model parameters useful in quality control.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Model fits are applied by default to values up to sunrise or after
sunset only as most critical to the model fit (capturing daylength,
i.e. latitude and the location of the diurnal pattern -
longitudinal displacement).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define land mask with a bounding box</span></span></span>
<span class="r-in"><span><span class="co"># and an off-shore buffer (in km), in addition</span></span></span>
<span class="r-in"><span><span class="co"># you can specify the resolution of the resulting raster</span></span></span>
<span class="r-in"><span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="stk_mask.html">stk_mask</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  bbox  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="op">-</span><span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">60</span><span class="op">)</span>, <span class="co">#xmin, ymin, xmax, ymax</span></span></span>
<span class="r-in"><span>  buffer <span class="op">=</span> <span class="fl">150</span>, <span class="co"># in km</span></span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># map grid in degrees</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Spherical geometry (s2) switched off</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># define a step selection distribution/function</span></span></span>
<span class="r-in"><span>  <span class="va">ssf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">shape</span> <span class="op">=</span> <span class="fl">0.9</span>, <span class="va">scale</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">tolerance</span> <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">tolerance</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">scale</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">x</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">scale</span><span class="op">)</span> <span class="op">/</span> <span class="va">norm</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate locations</span></span></span>
<span class="r-in"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="va">cc876</span> <span class="op">|&gt;</span> <span class="fu">skytrackr</span><span class="op">(</span></span></span>
<span class="r-in"><span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  mask <span class="op">=</span> <span class="va">mask</span>,</span></span>
<span class="r-in"><span>  step_selection <span class="op">=</span> <span class="va">ssf</span>,</span></span>
<span class="r-in"><span>  start_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        sampler <span class="op">=</span> <span class="st">'DEzs'</span>,</span></span>
<span class="r-in"><span>        settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        iterations <span class="op">=</span> <span class="fl">10</span>, <span class="co"># change iterations</span></span></span>
<span class="r-in"><span>         message <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>        <span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #9E9E9E;">══ </span><span style="color: #000000; font-weight: bold;">Estimating locations</span><span style="color: #9E9E9E;"> ══════════════════════════════════════ </span><span style="color: #0000BB;">skytrackr v1.1</span><span style="color: #9E9E9E;"> ══</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Processing logger: <span style="font-weight: bold;">CC876</span>!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → Smoothing the data using a Hampel filter</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [outliers will be replaced with interpolated values]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> (preview plot will update every 7 days)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Estimating positions <span style="color: #00BB00;">■■                              </span>   3% | ETA: 45s</span>
<span class="r-plt img"><img src="skytrackr-1.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Estimating positions <span style="color: #00BB00;">■■■■■■                          </span>  17% | ETA: 18s</span>
<span class="r-plt img"><img src="skytrackr-2.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="skytrackr-3.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Estimating positions <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■              </span>  57% | ETA:  6s</span>
<span class="r-plt img"><img src="skytrackr-4.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Estimating positions <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■    </span>  90% | ETA:  1s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - Estimating positions <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ </span> 100% | ETA:  0s</span>
<span class="r-plt img"><img src="skytrackr-5.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Data processing done ...</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/bluegreen-labs" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://bluegreenlabs.org/labs/" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="https://www.linkedin.com/company/bluegreen-labs/" target="_blank" class="external-link">
                          <div class="icon fa fa-linkedin"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://bluegreenlabs.org/#intro" class="external-link">BlueGreen Labs</a></li>
                            <li><a href="https://bluegreenlabs.org/#people" class="external-link">Our Team</a></li>
                            <li><a href="https://bluegreenlabs.org/#contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/bluegreen-labs" class="external-link">Packages</a></li>
                            <li><a href="https://bluegreenlabs.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://bluegreenlabs.org/post/" class="external-link">Blog</a></li>
                        </ul></div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer></div>






  </body></html>

